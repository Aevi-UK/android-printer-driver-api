
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>AEVI Printer Driver API Reference</title>

    <link rel="stylesheet" href="css/style.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

    <script src="js/lib/energize.js"></script>
<script src="js/lib/imagesloaded.min.js"></script>
<script src="js/lib/jquery_ui.js"></script>
<script src="js/lib/jquery.highlight.js"></script>
<script src="js/lib/jquery.tocify.js"></script>
<script src="js/lib/lunr.js"></script>
    <script src="js/script.js"></script>

    
      <script>
        $(function() {
            setupLanguages(["java"]);
        });
      </script>
    
  </head>

  <body class="">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png">
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png">
      
        <div class="lang-selector">
          
              <a href="#" data-language-name="java">java</a>
          
        </div>
      
      
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      
      <div id="toc">
      </div>
      
        <ul class="toc-footer">
          
              <li><a href="https://community.aevi.com">Join the AEVI community</a></li>
          
        </ul>
      
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The following documents describe how to use the AEVI Printer Driver API to implement a POS style printer driver for Aevi enabled devices. This API allows developers to quickly and easily create a driver for any manufacturers POS style printer which will in turn enable it to be used by value-added-application developers who are developing applications for Aevi enabled devices.</p>
<p>Each printer driver application is responsible for providing an implementation that is capable of connecting to, and handling printing for, one or more specific manufacturers printers. For instance a driver may be implemented to support a range of manufacturer printers.</p>
<p>The printer driver API itself makes extensive use of reactive (Rx) based principles. Therefore in the case of the Java API it makes heavy use of the RxJava library. To read more about Rx principles and the RxJava library itself see <a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">the documentation here</a>. For the remainder of this documentation it is assumed that the reader is familiar with asynchronous and event-based programming using observable streams.</p>
<p>Go register at our amazing developer portal here <a href="https://developer.aevi.com/" target="_blank" rel="external">developer portal</a>.</p>
<h1 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h1><p>Included in the driver repository is a <code>DemoPrinterDriver</code> application. This application shows the minimum steps that are required to create an Aevi enabled printer driver. This example uses the standard Android PrintManager to demonstrate the functionality, in your own implementation this is what would be replaced by printing via the manufacturer printer API or SDK.</p>
<p>All printer driver implementations will consist of implementations of three Android services and one Android ContentProvider.</p>
<ul>
<li>Driver Service - The main entry point for printing is a service that implements <code>BasePrinterDriverService</code> and provides basic printing functionality to all physically connected printers of this manufacturer type.</li>
<li>Settings Provider - An Android ContentProvider that will expose all the <code>PrinterSettings</code> for the printer</li>
<li>Statuses Service - A service that allows a user to monitor the status of the physical printers connected to by this driver</li>
<li>Actions Service - A service that allows custom actions to be sent to physical printers e.g. cut paper, open cash drawer.</li>
</ul>
<h2 id="Manifest-entries"><a href="#Manifest-entries" class="headerlink" title="Manifest entries"></a>Manifest entries</h2><pre><code class="highlight xml"><div class="line"><span class="tag">&lt;<span class="name">service</span></span></div><div class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".DemoPrinterDriverService"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">"com.aevi.permission.PRINTER_DRIVER_SERVICE"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"com.aevi.printer.driver.SERVICE"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"configuration-authority"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">"com.aevi.demoprinterdriver.config"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"printer-driver-name"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">"@string/app_driver_name"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"action-service"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">"com.aevi.demoprinterdriver.DemoPrinterActionService"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"status-service"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:value</span>=<span class="string">"com.aevi.demoprinterdriver.DemoPrinterStatusService"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">service</span></span></div><div class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".DemoPrinterActionService"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">"com.aevi.permission.PRINTER_DRIVER_SERVICE"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">service</span></span></div><div class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".DemoPrinterStatusService"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">"com.aevi.permission.PRINTER_DRIVER_SERVICE"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">service</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">provider</span></span></div><div class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.aevi.demoprinterdriver.DemoPrinterSettingsProvider"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">"com.aevi.demoprinterdriver.config"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:permission</span>=<span class="string">"com.aevi.permission.PRINTER_DRIVER_SERVICE"</span>/&gt;</span></div></code></pre>
<p>These four services/provider should be listed in the <code>AndroidManifest.xml</code> of your application as shown opposite.</p>
<p>Notice that the main driver service defines mata-data entries which provide the class names of the other three services/provider.</p>
<p>Also note that ALL the services/provider specify the permission <code>com.aevi.permission.PRINTER_DRIVER_SERVICE</code>. This is to ensure that only the Aevi printing service can access these services.</p>

        
          
              <h1 id="Printer-driver-service"><a href="#Printer-driver-service" class="headerlink" title="Printer driver service"></a>Printer driver service</h1><pre><code class="java highlight">
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPrinterDriverService</span> <span class="keyword">extends</span> <span class="title">BasePrinterDriverService</span> </span>{

    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = DemoPrinterDriverService.class.getSimpleName();

    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">final</span> PrintPayload payload)</span> </span>{
        Log.d(TAG, <span class="string">"Got print request: "</span> + payload.getPrinterId());

        <span class="keyword">try</span> {
            <span class="comment">// Send print data to printer here</span>
            <span class="comment">// ... uses manufacturer printer API/SDK ...</span>

            <span class="comment">// Use this methods to send printJob status(es) back to the client</span>
            PrintJob printJob = <span class="keyword">new</span> PrintJob(PRINTED);
            sendMessageToClient(payload.getId(), printJob);

            <span class="comment">// Use this method to notify the end the printJob</span>
            sendEndStreamMessageToClient(payload.getId());
        } <span class="keyword">catch</span>(Exception e) {

            <span class="comment">// Use this method to notify if an unexpected error has occurred</span>
            sendErrorMessageToClient(payload.getId(), PrinterMessages.ERROR_PRINT_FAILED,
                <span class="string">"Failed to print: "</span> + e.getMessage());
        }
    }
}
</code></pre>
<p>The main driver service should extend the <code>BasePrinterDriverService</code> and implement the <code>print</code> method. This method is responsible for taking the <code>PrintPayload</code> contents given and sending it to the physical printer as requested.</p>
<p>The <code>PrintPayload.getPrinterId()</code> method contains the unique identifier of the printer that this print should be sent to. This identifier is generated by this driver application initially and sent to users via the settings provider detailed below.</p>
<p>Once the print has been successfully sent to the printer the driver should call the <code>sendMessageToClient</code> method reporting a <code>PrintJob</code> object back to the user. The <code>PrintJob</code> object contains the status of the print and potentially some useful diagnostic information if required.</p>
<p>The <code>PrintJob</code> object returned can contain the <code>State</code> of the print which is either <code>IN_PROGRESS</code>, <code>PRINTED</code> or <code>FAILED</code>.</p>
<p>If the printing fails unexpectedly then the driver should call the <code>sendErrorMessageToClient</code> with a suitable error response.</p>

          
              <h1 id="Printer-settings-provider"><a href="#Printer-settings-provider" class="headerlink" title="Printer settings provider"></a>Printer settings provider</h1><pre><code class="java highlight"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPrinterSettingsProvider</span> <span class="keyword">extends</span> <span class="title">BasePrinterSettingsProvider</span> </span>{

    <span class="meta">@Override</span>
    <span class="keyword">protected</span> PrinterSettings[] getPrintersSettings() {
        <span class="keyword">return</span> PrinterSettingsHolder.getInstance().getPrinterSettings();
    }
}
</code></pre>
<p>The printer settings provider implementation should extend the <code>BasePrinterSettingsProvider</code> class and implement the <code>getPrintersSettings</code> method.</p>
<p>This method is responsible for returning a graph of objects indicating the current settings and capabilities of the printer(s) that this driver can connect to.</p>
<p>A <code>PrinterSettings</code> object will be returned for each known printer this driver can access.</p>
<p>The <code>PrinterSettings</code> object contains information about:</p>
<ul>
<li>paperwidth - The paper width supported by this printer in mm</li>
<li>printableWidth - The maximum width this printer can print on the paper size given above in mm</li>
<li>dotsPerMm - The number of dots this printer can support per mm (to convert to dpi multiply by 25.4)</li>
<li>paperkind - The type of paper supported by this printer e.g. THERMAL, NORMAL</li>
<li>codepages - The character codepages a printer will accept</li>
<li>actions - The actions that can be sent to this printer to perform a task e.g. “cutPaper”</li>
<li>options - A <code>Map</code> of String key value pairs that describe any printer specific options this printer exposes</li>
<li>fonts - A list of fonts the printer supports</li>
<li>languages - A list of language code supported by the printer. This allows text characters to be sent in different languages if the printer supports it.</li>
</ul>
<pre><code class="java highlight">
<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PrinterFont FONT_A = <span class="keyword">new</span> PrinterFontBuilder()
        .withId(Printer.FONT_A)
        .withName(<span class="string">"Font A"</span>)
        .withSupportedFontStyles(FontStyle.values())
        .withHeight(<span class="number">24</span>)
        .withWidth(<span class="number">12</span>)
        .withLineHeight(<span class="number">32</span>)
        .withIsDefault(<span class="keyword">true</span>)
        .withNumColumns(<span class="number">48</span>)
        .build();

<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PrinterFont FONT_B = <span class="keyword">new</span> PrinterFontBuilder()
        .withId(Printer.FONT_B)
        .withName(<span class="string">"Font B"</span>)
        .withSupportedFontStyles(FontStyle.values())
        .withHeight(<span class="number">17</span>)
        .withWidth(<span class="number">9</span>)
        .withLineHeight(<span class="number">25</span>)
        .withIsDefault(<span class="keyword">false</span>)
        .withNumColumns(<span class="number">64</span>)
        .build();

<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> PrinterFont[] DEFAULT_FONTS = <span class="keyword">new</span> PrinterFont[]{
        FONT_A,
        FONT_B
};

<span class="function"><span class="keyword">public</span> PrinterSettings <span class="title">getSettings</span><span class="params">()</span> </span>{
    <span class="keyword">return</span> <span class="keyword">new</span> PrinterSettingsBuilder(getPrinterId(), PAPER_WIDTH, PRINTABLE_WIDTH, PAPER_DOTS_PER_MM)
            .withPrinterFonts(DEFAULT_FONTS)
            .withPaperKind(PaperKind.THERMAL)
            .withDoesReportStatus(<span class="keyword">true</span>)
            .withCanHandleCommands(<span class="keyword">true</span>)
            .withDoesSupportCodepages(<span class="keyword">false</span>)
            .withSupportedLanguages(SUPPORTED_LANGUAGES)
            .build();
}
</code></pre>
<p>To assist with building the <code>PrinterSettings</code> a builders are provided in this api. The example opposite shows how this may be constructed.</p>
<p>In particular the driver should ensure that it returns information about the Fonts available on the printer and that the sizes given are accurate. These values are used to create the Print Preview for the user when requested, so in order to provide an accurate indication of the final printout this information should be given as accuractely as possible.</p>
<blockquote>
<p>Note that sizes are in mm and/or printer dots, see the Javadoc for details.</p>
</blockquote>

          
              <h1 id="Printer-statuses-service"><a href="#Printer-statuses-service" class="headerlink" title="Printer statuses service"></a>Printer statuses service</h1><pre><code class="java highlight"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPrinterStatusService</span> <span class="keyword">extends</span> <span class="title">BasePrinterStatusService</span> </span>{
    <span class="comment">// There is nothing to do here</span>
}
</code></pre>
<p>This service should extend the <code>BasePrinterStatusService</code> class. No implementation is required, this class serves merely as a way to expose the service in your Android manifest.</p>
<pre><code class="java highlight">
PrinterStatusStream.emitStatus(<span class="string">"printerId"</span>, PrinterMessages.ERROR_PRINT_FAILED);
</code></pre>
<p>Statuses can be sent to the user using the <code>PrinterStatusStream.emitStatus()</code> method. This method requires you pass in the id of the printer the status is for and a String status message. Various default messages are provided in the <code>PrinterMessages</code> class.</p>

          
              <h1 id="Printer-actions-service"><a href="#Printer-actions-service" class="headerlink" title="Printer actions service"></a>Printer actions service</h1><pre><code class="java highlight"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoPrinterActionService</span> <span class="keyword">extends</span> <span class="title">BasePrinterActionService</span> </span>{

    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">(String printerId, String action)</span> </span>{

    }
}
</code></pre>
<p>The printer actions service should extend the <code>BasePrinterActionService</code> class and implement to action method.</p>
<p>String actions can be sent to this service and the driver is responsible for performing the action on the physical printer.</p>
<p>The actions that each printer can perform are given to the user in the <code>PrinterSettings</code> object.</p>

          
        
      </div>
      <div class="dark-box">
        
          <div class="lang-selector">
            
                <a href="#" data-language-name="java">java</a>
            
          </div>
        
      </div>
    </div>
  </body>
</html>
